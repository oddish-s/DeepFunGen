import { State } from './state.js';

const translations = {
    ko: {
        'app.title': 'DeepFunGen',
        'app.version_label': '버전',
        'nav.add': '파일 추가',
        'nav.queue': '작업 대기열',
        'nav.viewer': '뷰어',
        'nav.logs': '로그',
        'nav.license': '라이선스',
        'nav.settings': '설정',
        'view.add': '파일 추가',
        'view.queue': '작업 대기열',
        'view.viewer': '결과 뷰어',
        'view.logs': '실시간 로그',
        'view.settings': '환경 설정',
        'view.license': '라이선스',
        'actions.toggle_theme': '테마 전환',
        'status.gpu': 'GPU',
        'status.cpu': 'CPU',
        'status.queue': '대기열',
        'status.provider': '실행 엔진',
        'add.title': '파일 추가',
        'add.subtitle': '영상 파일을 스테이징하고 옵션을 지정한 뒤 대기열에 추가하세요.',
        'add.model_label': '모델',
        'add.model_vr_only': 'VR 모델',
        'add.no_models_vr': '선택 가능한 VR 모델이 없습니다.',
        'add.no_models_non_vr': '선택 가능한 일반 모델이 없습니다.',
        'add.drop_message': '여기에 영상 파일을 끌어다 놓으세요',
        'add.browse_files': '파일 선택',
        'add.browse_folder': '폴더 선택',
        'add.staged_title': '스테이징 목록',
        'add.options_title': '처리 옵션',
        'add.opt_min_prominence': '최소 두드러짐',
        'add.opt_max_slope': '최대 기울기',
        'add.opt_boost_slope': '부스트 기울기',
        'add.opt_min_slope': '최소 기울기',
        'add.opt_fft_denoise': 'FFT 노이즈 제거',
        'add.opt_fft_frames': 'FFT 프레임 / 컴포넌트',
        'add.opt_fft_window': 'FFT 윈도 프레임',
        'add.tooltip.smooth': '원신호를 완화할 때 사용하는 이동 평균 프레임 수입니다.',
        'add.tooltip.prominence': '국소 범위 대비 최소 피크 돌출 비율 (0–1)입니다.',
        'add.tooltip.min_prominence': '스무딩 후 피크가 유지되기 위한 돌출 값의 최솟값입니다.',
        'add.tooltip.max_slope': '이 값보다 가파른 변화 구간은 제외합니다.',
        'add.tooltip.boost_slope': '이 값 이하의 기울기를 증폭해 미세한 움직임을 강조합니다.',
        'add.tooltip.min_slope': '이 값보다 낮은 기울기는 노이즈로 간주해 무시합니다.',
        'add.tooltip.merge': '이 값(ms)보다 가까운 이벤트는 하나로 병합합니다.',
        'add.tooltip.fft_denoise': '피크 검출 전에 FFT 기반 노이즈 제거를 수행합니다.',
        'add.tooltip.fft_frames': 'FFT 노이즈 제거 시 컴포넌트당 사용할 프레임 수입니다.',
        'add.tooltip.fft_window': 'FFT 윈도 크기를 수동 지정합니다 (비우면 자동입니다).',
        'add.toast_unsupported': '지원하지 않는 파일 형식입니다.',
        'add.toast_drop_failed': '현재 환경에서는 드래그 앤 드롭을 사용할 수 없습니다.',
        'add.toast_drop_skipped': '새로운 파일이 추가되지 않았습니다.',
        'add.toast_browser_no_path': '브라우저에서는 파일 경로에 접근할 수 없습니다. 데스크톱 앱을 사용해주세요.',
        'queue.no_staged': '스테이징된 파일이 없습니다.',
        'queue.enqueue': '대기열에 추가',
        'queue.remove': '제거',
        'queue.cancel': '취소',
        'queue.opt_smooth': '스무딩 윈도',
        'queue.opt_prominence': '프로미넌스 비율',
        'queue.opt_merge': '병합 임계값 (ms)',
        'queue.opt_recursive': '하위 폴더 포함',
        'queue.active_title': '작업 대기열',
        'queue.subtitle': '대기, 실행, 완료된 작업을 한 곳에서 확인하세요.',
        'queue.intake_title': '영상 추가',
        'queue.intake_subtitle': '파일을 추가하면 기본 옵션으로 즉시 대기열에 등록됩니다.',
        'queue.intake_model_title': '모델 선택',
        'queue.manual_label': '절대 경로 입력',
        'queue.manual_add': '대기열 추가',
        'queue.manual_hint': '파일 대화상자를 사용할 수 없을 때 직접 경로를 입력하세요.',
        'queue.manual_empty': '먼저 영상 경로를 입력하세요.',
        'queue.refresh': '새로 고침',
        'queue.clear_finished': '완료 작업 정리',
        'queue.table.video': '영상',
        'queue.table.stats': '상태·진행',
        'queue.table.model': '모델',
        'queue.table.options': '처리 옵션',
        'queue.table.actions': '동작',
        'queue.empty': '대기열이 비어 있습니다.',
        'queue.toast_added': '{count}개 파일이 대기열에 추가되었습니다.',
        'queue.toast_skipped': '모든 항목이 건너뛰어졌습니다.',
        'queue.toast_cancelled': '작업이 취소되었습니다.',
        'queue.toast_cleared': '완료된 작업이 정리되었습니다.',
        'queue.toast_select': '먼저 영상을 선택하세요.',
        'queue.toast_dialog': '파일 대화상자를 사용할 수 없습니다.',
        'queue.open_viewer': '뷰어 열기',
        'queue.open_csv': 'CSV 열기',
        'queue.open_folder': '폴더 열기',
        'queue.no_csv': '예측 CSV가 아직 생성되지 않았습니다.',
        'queue.no_folder': '열 수 있는 폴더가 없습니다.',
        'queue.stats.pre': '전처리',
        'queue.stats.infer': '추론',
        'queue.stats.eta': '예상',
        'queue.stats.elapsed': '경과',
        'queue.status.pending': '대기',
        'queue.status.processing': '처리 중',
        'queue.status.completed': '완료',
        'queue.status.failed': '실패',
        'queue.status.cancelled': '취소됨',
        'viewer.model': '모델',
        'viewer.no_data': '완료된 작업을 선택하세요.',
        'viewer.plot_placeholder': '그래프 렌더링 준비 중입니다.',
        'viewer.cursor_time': '시간',
        'viewer.cursor_value': '값',
        'viewer.window_label': '구간',
        'viewer.preview_hint': '그래프 위에 마우스를 올리면 프레임이 표시됩니다.',
        'viewer.current_value': '현재 값',
        'viewer.options_heading': '후처리 옵션',
        'viewer.options_apply': '적용',
        'viewer.options_fft_window_placeholder': '자동',
        'viewer.options_status_select': '먼저 완료된 작업을 선택하세요.',
        'viewer.options_status_busy': '옵션을 적용하는 중입니다…',
        'viewer.options_status_unavailable': '처리가 끝난 뒤에 옵션을 변경할 수 있습니다.',
        'viewer.options_status_applied': '옵션이 업데이트되었습니다.',
        'viewer.options_status_error': '옵션 적용에 실패했습니다.',
        'viewer.options_toast_nochange': '변경된 옵션이 없습니다.',
        'viewer.options_toast_applied': '옵션이 업데이트되었습니다.',
        'viewer.options_toast_invalid': '옵션을 읽어오지 못했습니다.',
        'viewer.no_options': '설정된 후처리 옵션이 없습니다.',
        'viewer.auto': '자동',
        'viewer.boolean_on': '켜짐',
        'viewer.boolean_off': '꺼짐',
        'viewer.back_to_queue': '큐로 돌아가기',
        'logs.title': '실시간 로그',
        'logs.show_info': '정보',
        'logs.show_warning': '경고',
        'logs.show_error': '오류',
        'logs.auto_scroll': '자동 스크롤',
        'settings.title': '설정',
        'settings.appearance': '모양',
        'settings.language': '언어',
        'settings.korean': '한국어',
        'settings.english': '영어',
        'settings.defaults': '기본값',
        'settings.dark': '다크',
        'settings.light': '라이트',
        'settings.default_model': '기본 모델',
        'settings.postprocess_header': '후처리 옵션',
        'settings.save': '설정 저장',
        'settings.autosave_hint': '변경 사항은 자동으로 저장됩니다.',
        'license.title': '오픈 소스 라이선스',
        'license.subtitle': '이 애플리케이션에 포함된 서드파티 소프트웨어의 라이선스를 안내합니다.',
        'license.license_label': '라이선스',
        'license.loading': '라이선스 정보를 불러오는 중입니다...',
        'license.none': '표시할 서드파티 공지가 없습니다.',
        'settings.updates': '업데이트',
        'settings.current_version': '현재 버전',
        'settings.check_updates': '업데이트 확인',
        'settings.smooth_window': '스무딩 윈도',
        'settings.prominence_ratio': '프로미넌스 비율',
        'settings.merge_threshold': '병합 임계값',
        'common.path_copied': '경로가 클립보드에 복사되었습니다.',
    },
    en: {
        'app.title': 'DeepFunGen',
        'app.version_label': 'Version',
        'nav.add': 'Add Files',
        'nav.queue': 'Queue',
        'nav.viewer': 'Viewer',
        'nav.logs': 'Logs',
        'nav.license': 'Licenses',
        'nav.settings': 'Settings',
        'view.add': 'Add Files',
        'view.queue': 'Processing Queue',
        'view.viewer': 'Viewer',
        'view.logs': 'Live Logs',
        'view.license': 'Licenses',
        'view.settings': 'Settings',
        'actions.toggle_theme': 'Toggle Theme',
        'status.gpu': 'GPU',
        'status.cpu': 'CPU',
        'status.queue': 'Queue',
        'status.provider': 'Provider',
        'add.title': 'Add Files',
        'add.subtitle': 'Stage videos, configure options, and enqueue jobs.',
        'add.model_label': 'Model',
        'add.model_vr_only': 'VR models',
        'add.no_models_vr': 'No VR models available.',
        'add.no_models_non_vr': 'No non-VR models available.',
        'add.drop_message': 'Drop videos here',
        'add.browse_files': 'Browse Files',
        'add.browse_folder': 'Browse Folder',
        'add.staged_title': 'Staged Items',
        'add.options_title': 'Processing Options',
        'add.opt_min_prominence': 'Min Prominence',
        'add.opt_max_slope': 'Max Slope',
        'add.opt_boost_slope': 'Boost Slope',
        'add.opt_min_slope': 'Min Slope',
        'add.opt_fft_denoise': 'FFT Denoise',
        'add.opt_fft_frames': 'FFT Frames / Component',
        'add.opt_fft_window': 'FFT Window Frames',
        'add.tooltip.smooth': 'Number of frames used when smoothing the raw signal.',
        'add.tooltip.prominence': 'Minimum peak prominence relative to the local range (0–1).',
        'add.tooltip.min_prominence': 'Absolute floor for peak prominence after smoothing.',
        'add.tooltip.max_slope': 'Discard transitions with slopes steeper than this value.',
        'add.tooltip.boost_slope': 'Scale slopes up to this value to emphasise subtle motion.',
        'add.tooltip.min_slope': 'Ignore slopes below this value to suppress noise.',
        'add.tooltip.merge': 'Merge neighbouring events separated by fewer milliseconds than this value.',
        'add.tooltip.fft_denoise': 'Apply FFT-based denoising before detecting peaks.',
        'add.tooltip.fft_frames': 'Frames per FFT component when performing denoising.',
        'add.tooltip.fft_window': 'Override the FFT window size (leave blank for automatic).',
        'add.toast_unsupported': 'Unsupported file type.',
        'add.toast_drop_failed': 'Drag-and-drop is not available in this environment.',
        'add.toast_drop_skipped': 'No new files were staged.',
        'add.toast_browser_no_path': 'Browsers cannot expose file paths. Please use the desktop app.',
        'queue.no_staged': 'No files staged.',
        'queue.enqueue': 'Add to Queue',
        'queue.remove': 'Remove',
        'queue.cancel': 'Cancel',
        'queue.opt_smooth': 'Smooth Window',
        'queue.opt_prominence': 'Prominence Ratio',
        'queue.opt_merge': 'Merge Threshold (ms)',
        'queue.opt_recursive': 'Include Subfolders',
        'queue.active_title': 'Processing Queue',
        'queue.subtitle': 'Track queued, running, and completed jobs.',
        'queue.intake_title': 'Add Videos',
        'queue.intake_subtitle': 'Drop files to enqueue them with default processing options.',
        'queue.intake_model_title': 'Model Selection',
        'queue.manual_label': 'Enter absolute path',
        'queue.manual_add': 'Queue',
        'queue.manual_hint': 'Use this when file dialogs cannot expose the original path.',
        'queue.manual_empty': 'Enter a video path first.',
        'queue.refresh': 'Refresh',
        'queue.clear_finished': 'Clear Finished',
        'queue.table.video': 'Video',
        'queue.table.stats': 'Status/Progress',
        'queue.table.model': 'Model',
        'queue.table.options': 'Options',
        'queue.table.actions': 'Actions',
        'queue.empty': 'Queue is empty.',
        'queue.toast_added': '{count} file(s) added to queue.',
        'queue.toast_skipped': 'All files were skipped.',
        'queue.toast_cancelled': 'Job cancelled.',
        'queue.toast_cleared': 'Finished jobs cleared.',
        'queue.toast_select': 'Select at least one video.',
        'queue.toast_dialog': 'Native dialog is unavailable.',
        'queue.open_viewer': 'Open Viewer',
        'queue.open_csv': 'Open CSV',
        'queue.open_folder': 'Open Folder',
        'queue.no_csv': 'Prediction CSV not available yet.',
        'queue.no_folder': 'No folder available to open.',
        'queue.stats.pre': 'Preprocess',
        'queue.stats.infer': 'Inference',
        'queue.stats.eta': 'ETA',
        'queue.stats.elapsed': 'Elapsed',
        'queue.status.pending': 'Pending',
        'queue.status.processing': 'Processing',
        'queue.status.completed': 'Completed',
        'queue.status.failed': 'Failed',
        'queue.status.cancelled': 'Cancelled',
        'viewer.model': 'Model',
        'viewer.no_data': 'Select a completed job to visualise predictions.',
        'viewer.plot_placeholder': 'Plot rendering coming soon.',
        'viewer.cursor_time': 'Time',
        'viewer.cursor_value': 'Value',
        'viewer.window_label': 'Window Range',
        'viewer.preview_hint': 'Hover the graph to preview frames.',
        'viewer.current_value': 'Current Value',
        'viewer.options_heading': 'Processing Options',
        'viewer.options_apply': 'Apply',
        'viewer.options_fft_window_placeholder': 'Auto',
        'viewer.options_status_select': 'Select a completed job first.',
        'viewer.options_status_busy': 'Updating options…',
        'viewer.options_status_unavailable': 'Wait for processing to finish before updating options.',
        'viewer.options_status_applied': 'Options updated.',
        'viewer.options_status_error': 'Failed to update options.',
        'viewer.options_toast_nochange': 'No option changes detected.',
        'viewer.options_toast_applied': 'Options updated.',
        'viewer.options_toast_invalid': 'Unable to gather options.',
        'viewer.no_options': 'No post-processing options.',
        'viewer.auto': 'Auto',
        'viewer.boolean_on': 'On',
        'viewer.boolean_off': 'Off',
        'viewer.back_to_queue': 'Back to Queue',
        'logs.title': 'Live Logs',
        'logs.show_info': 'Info',
        'logs.show_warning': 'Warn',
        'logs.show_error': 'Error',
        'logs.auto_scroll': 'Auto Scroll',
        'settings.title': 'Settings',
        'settings.appearance': 'Appearance',
        'settings.language': 'Language',
        'settings.korean': 'Korean',
        'settings.english': 'English',
        'settings.defaults': 'Defaults',
        'settings.dark': 'Dark',
        'settings.light': 'Light',
        'settings.default_model': 'Default Model',
        'settings.postprocess_header': 'Post-processing Options',
        'settings.save': 'Save Settings',
        'settings.autosave_hint': 'Changes are saved automatically.',
        'license.title': 'Open Source Licenses',
        'license.subtitle': 'This application bundles the following third-party software.',
        'license.license_label': 'License',
        'license.loading': 'Loading license information...',
        'license.none': 'No third-party notices available.',
        'settings.updates': 'Updates',
        'settings.current_version': 'Current version',
        'settings.check_updates': 'Check for Updates',
        'settings.smooth_window': 'Smooth Window',
        'settings.prominence_ratio': 'Prominence Ratio',
        'settings.merge_threshold': 'Merge Threshold',
        'common.path_copied': 'Path copied to clipboard.',
    },
};

function translate(key, language = State.get('language') || 'en') {
    const catalog = translations[language] || translations.en;
    return catalog[key] || translations.en[key] || key;
}

function apply() {
    const lang = State.get('language') || 'en';
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-i18n]').forEach((element) => {
        const key = element.getAttribute('data-i18n');
        element.textContent = translate(key, lang);
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach((element) => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.setAttribute('placeholder', translate(key, lang));
    });
    document.querySelectorAll('[data-i18n-tooltip]').forEach((element) => {
        const key = element.getAttribute('data-i18n-tooltip');
        const value = translate(key, lang);
        element.setAttribute('data-tooltip', value);
        element.setAttribute('title', value);
    });
    document.querySelectorAll('[data-i18n-prefix]').forEach((element) => {
        const key = element.getAttribute('data-i18n-prefix');
        const value = translate(key, lang);
        const suffix = element.textContent.split(':').pop()?.trim() ?? '';
        element.textContent = suffix ? `${value}: ${suffix}` : value;
    });
}

export const I18n = {
    t: translate,
    apply,
    setLanguage(language) {
        State.setLanguage(language);
        apply();
    },
    init() {
        apply();
        State.subscribe('language', apply);
    },
};

document.addEventListener('DOMContentLoaded', () => {
    I18n.init();
});

export default I18n;


